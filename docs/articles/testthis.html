<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>testthis package vignette • testthis</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">testthis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/testthis.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/s-fleck/testthis">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>testthis package vignette</h1>
                        <h4 class="author">Stefan Fleck</h4>
            
            <h4 class="date">2017-10-26</h4>
          </div>

    
    
<div class="contents">
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Testthis contains tools to make unit testing in R more comfortable. It is designed to complement the packages <strong>testthat</strong>, <strong>devtools</strong> and <strong>usethis</strong>.</p>
</div>
<div id="rstudio-addins" class="section level2">
<h2 class="hasAnchor">
<a href="#rstudio-addins" class="anchor"></a>RStudio addins</h2>
<p>Testthis provides RStudio addins for common tasks. These can be called like normal R function, but it is also possible to assigned to hotkeys to them in RStudio (<em>Tools/Modify Keyboard Shortcuts</em>). I recommend assigning <code>ctrl+alt+Insert</code>, <code>ctrl+alt+Pos1</code> and <code>ctrl+alt+PageUp</code> to the following functions:</p>
<ul>
<li>
<code><a href="../reference/test_this.R.html">test_this()</a></code>: Run tests associated with the currently open R script file.</li>
<li>
<code><a href="../reference/test_this.R.html">lest_this()</a></code>: “Load and test”; As above, but call <code><a href="http://www.rdocumentation.org/packages/devtools/topics/load_all">devtools::load_all()</a></code> first</li>
<li>
<code><a href="../reference/open_testfile.html">open_testfile()</a></code>: Opens the associated testfile in an editor window. If the currently open file already is a testfile, it opens the associated file in the <code>/R</code> directory. Can be used to jump back and forth between both.</li>
<li>
<code><a href="../reference/test_with_skip.html">test_with_skip()</a></code>: Like <code><a href="http://www.rdocumentation.org/packages/devtools/topics/test">devtools::test()</a></code>, but does not run test files that contain the line <code>#' @skip.</code>
</li>
</ul>
<p>The functions above assume that if the current filename is <code>currentfile.R</code>, the associated test file is <code>/tests/testthat/test_currentfile.R</code>. If you want to modify this behaviour you can put the tag <code>#* @testfile anotherfile</code> anywhere in your code, usually the top or bottom of your <code>.R</code> file. Each R script can only have a single associated testfile.</p>
<p>The following example will associate the file <code>/tests/testthat/other_test_file.R</code> instead of <code>/tests/testthat/test_open_testfile.R</code> with <code>R/open_testfile</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># file R/open_testfile.R</span>

<span class="co">#* @testfile other_testfile</span>
open_testfile &lt;-<span class="st"> </span><span class="cf">function</span>(){
  fname &lt;-<span class="st"> </span><span class="kw">get_testfile_name</span>()

  <span class="cf">if</span>(<span class="kw">file.exists</span>(fname)){
    rstudioapi<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstudioapi/topics/navigateToFile">navigateToFile</a></span>(fname)
  } <span class="cf">else</span> {
    <span class="kw"><a href="../reference/test_skeleton.html">test_skeleton</a></span>(fname, <span class="dt">open =</span> <span class="ot">TRUE</span>)
  }
}</code></pre></div>
</div>
<div id="managing-test-data" class="section level2">
<h2 class="hasAnchor">
<a href="#managing-test-data" class="anchor"></a>Managing test data</h2>
<p>Sometimes, it might become necessary to have access to complex data sets for tests. The recommended way for dealing with this is to provide an example dataset in your packages <code>data/</code> directory; however, there are also usecases where you want seperate data files for your tests.</p>
<p>Testthis provides three functions to to make dealing with separate test data files a bit easier:</p>
<ul>
<li>
<code><a href="../reference/use_testdata.html">use_testdata()</a></code> places a single R object in the <code>tests/testhat/testdata</code> directory. It is analoguous to <code><a href="http://www.rdocumentation.org/packages/usethis/topics/use_data">usethis::use_data()</a></code>, except that it saves the Object in the <code>.rds</code> format, which is more convenient for single R Objects than <code>.rda</code> or <code>.Rdata</code> (see <code>?readRDS</code>).</li>
<li>
<code><a href="../reference/use_testdata_raw.html">use_testdata_raw()</a></code> creates the directory <code>tests/testhat/testdata-raw</code>. Use this directory to put scripts that generate the data in <code>tests/testhat/testdata</code>.</li>
<li>
<code><a href="../reference/use_testdata.html">read_testdata()</a></code> is a simple wrapper for <code>readRDS()</code> to read files in <code>tests/testhat/testdata</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/use_testdata.html">use_testdata</a></span>(iris)
## Saving to 
## * r/testthis/tests/testthat/testdata/iris.rds

tdat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/use_testdata.html">read_testdata</a></span>(<span class="st">"iris.rds"</span>)

<span class="kw"><a href="../reference/use_testdata_raw.html">use_testdata_raw</a></span>()
## ✔ Creating 'tests/testthat/testdata-raw/'</code></pre></div>
</div>
<div id="managing-test-subdirectories" class="section level2">
<h2 class="hasAnchor">
<a href="#managing-test-subdirectories" class="anchor"></a>Managing test subdirectories</h2>
<p>Sometimes it is useful to create tests for a package that go beyond simple best-practice unit tests. For example you might have some tests that require external ressources (web, databases) or take long to execute. If you put such tests in subdirectories of <code>test/testthat</code> they will neither be automaticaly executed by <code><a href="http://www.rdocumentation.org/packages/devtools/topics/test">devtools::test()</a></code> nor run on CRAN.</p>
<p>testthis provides helpers do deal with files in subdirectories of <code>tests/testthat</code>.</p>
<ul>
<li>
<code><a href="../reference/use_test_subdir.html">use_test_subdir()</a></code> create a subdir in <code>tests/testthat/</code> and (optionally) an R script in <code>/R</code> that contains a helper function to run all tests in that subdir. By default, said .R script will be added to your packages <code>.Rbuildignore</code> as it is only useful during package development. Tests in subdirectories of a packages test dir will <em>not</em> be run on CRAN on CRAN or by <code><a href="http://www.rdocumentation.org/packages/devtools/topics/test">devtools::test()</a></code>.</li>
<li>You can also just manually use <code><a href="../reference/test_subdir.html">test_subdir("mysubdir")</a></code> to run tests in a subdir of <code>tests/testthat</code>.</li>
<li>
<code><a href="../reference/test_subdir.html">test_acceptance()</a></code>, <code><a href="../reference/test_subdir.html">test_manual()</a></code> and <code><a href="../reference/test_subdir.html">test_integration()</a></code> are presets to run tests in the <code>integration_tests</code>, <code>acceptance_tests</code> and <code>manual_tests</code> subdirectories of <code>test/testthat</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/use_test_subdir.html">use_test_subdir</a></span>(<span class="st">"foobar_tests"</span>)
## ✔ Creating 'tests/testthat/foobar_tests/'
## creating tester function test_foobar_tests() in r/testthis/R/testthis-testers.R

<span class="kw"><a href="../reference/test_subdir.html">test_subdir</a></span>(<span class="st">"foobar_tests"</span>)
## No tests: no files in r/testthis/tests/testthat/foobar_tests match '^test.*\.[rR]$'</code></pre></div>
</div>
<div id="test-coverage-checklist" class="section level2">
<h2 class="hasAnchor">
<a href="#test-coverage-checklist" class="anchor"></a>Test coverage checklist</h2>
<p><strong>This is an experimental feature, comments and feature request are welcome</strong>. Testthis provides a checklist like test coverage analyser. This is non-automatic and requires you to manually mark functions as tested in your code via special comments. If you look for automatic test coverage analysis, you might want to check out the <code>covr</code> package instead.</p>
<p>For testthis to recognize wheter a unit test exists for a function, the function name must either be mention in a <code>testthat()</code> <code>desc</code> argument, or marked via special comment tag: <code>#* @testing functionname</code>. If you want to mark a function as not requiring testing, you can add the function name to the file <code>/tests/testthat/_testignore</code> manually, or with <code><a href="../reference/use_testignore.html">use_testignore()</a></code>.</p>
<p>The following example will mark the functions <code>parse_testthis_comments</code> and <code>detect_testthis_comments</code> as tested:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># file /tests/testhis/parse_testthis_comments.R</span>

<span class="kw">test_that</span>(<span class="st">"parse_testthis_comments works as expected"</span>, {
  <span class="co">#* @testing detect_testthis_comments</span>
  ...
}</code></pre></div>
<p>The test_coverage summary for a package may look like this (+ marks function for which tests exist):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_test_coverage.html">get_test_coverage</a></span>()
<span class="co">#&gt; Package /home/hoelk/Dropbox/workspace/r/testthis, Test Coverage: 25.9%</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  exported functions ....................                        </span>
<span class="co">#&gt;  - get_test_coverage    </span>
<span class="co">#&gt;  - lest_this            </span>
<span class="co">#&gt;  - open_testfile        </span>
<span class="co">#&gt;    read_testdata        </span>
<span class="co">#&gt;  - test_acceptance      </span>
<span class="co">#&gt;    test_all             </span>
<span class="co">#&gt;  - test_integration     </span>
<span class="co">#&gt;  - test_manual          </span>
<span class="co">#&gt;    test_skeleton        </span>
<span class="co">#&gt;  + test_subdir          </span>
<span class="co">#&gt;  - test_this            </span>
<span class="co">#&gt;  - test_with_skip       </span>
<span class="co">#&gt;    use_acceptance_tests </span>
<span class="co">#&gt;    use_integration_tests</span>
<span class="co">#&gt;    use_manual_tests     </span>
<span class="co">#&gt;  + use_test_subdir      </span>
<span class="co">#&gt;  + use_testdata         </span>
<span class="co">#&gt;    use_testdata_raw     </span>
<span class="co">#&gt;  + use_tester           </span>
<span class="co">#&gt;  + use_testignore       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  S3 Methods ....................                     </span>
<span class="co">#&gt;   print.Test_coverage</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  internal functions ....................                                     </span>
<span class="co">#&gt;    .onLoad                           </span>
<span class="co">#&gt;  + detect_testthis_comments          </span>
<span class="co">#&gt;    dir_mock                          </span>
<span class="co">#&gt;    extract_test_that_desc            </span>
<span class="co">#&gt;  + extract_testthis_comments         </span>
<span class="co">#&gt;    find_test_scripts_mock            </span>
<span class="co">#&gt;    get_current_file                  </span>
<span class="co">#&gt;    get_pkg_exports                   </span>
<span class="co">#&gt;    get_pkg_functions                 </span>
<span class="co">#&gt;    get_pkg_S3methods                 </span>
<span class="co">#&gt;  + get_pkg_tested_functions          </span>
<span class="co">#&gt;  + get_pkg_tested_functions_from_desc</span>
<span class="co">#&gt;    get_pkg_tested_functions_from_tags</span>
<span class="co">#&gt;    get_pkg_testfile_names_from_tags  </span>
<span class="co">#&gt;    get_pkg_testignore                </span>
<span class="co">#&gt;    get_rdir_taglist                  </span>
<span class="co">#&gt;  + get_tag                           </span>
<span class="co">#&gt;  + get_taglist                       </span>
<span class="co">#&gt;    get_test_taglist                  </span>
<span class="co">#&gt;    get_testfile_name                 </span>
<span class="co">#&gt;    get_testfile_name_from_tag        </span>
<span class="co">#&gt;  + has_testdata                      </span>
<span class="co">#&gt;    is_in_rdir                        </span>
<span class="co">#&gt;    is_testfile                       </span>
<span class="co">#&gt;    is_testfiles                      </span>
<span class="co">#&gt;    is_valid                          </span>
<span class="co">#&gt;    is_valid.Test_coverage            </span>
<span class="co">#&gt;    list_rdir_files                   </span>
<span class="co">#&gt;  + list_test_files                   </span>
<span class="co">#&gt;    msg_testfile_does_not_exist       </span>
<span class="co">#&gt;    open_associated_rfile             </span>
<span class="co">#&gt;    require_rstudio                   </span>
<span class="co">#&gt;  + skip_test_files                   </span>
<span class="co">#&gt;    taglist                           </span>
<span class="co">#&gt;    test_coverage                     </span>
<span class="co">#&gt;    test_foobar_tests                 </span>
<span class="co">#&gt;  + testthis_tokenizer</span></code></pre></div>
</div>
<div id="testthis-tags" class="section level2">
<h2 class="hasAnchor">
<a href="#testthis-tags" class="anchor"></a>Testthis Tags</h2>
<p>Test_this tags are special comments that modify the behavious of the functions supplied by this package. They are of the Form <code>#* @tag &lt;value&gt;</code>. Please not that only some test_this tags really require a <code>&lt;value&gt;</code>. The tag system should be considered to be in a beta-state.</p>
<p><strong>Valid tags for script files in the /R/ dir (<code>pkg/R/*.R</code>)</strong></p>
<ul>
<li>
<code>@testfile &lt;filename&gt;</code>: manually specifiy associated test file. Should usually start with <code>test_</code>. This is used by <code><a href="../reference/test_this.R.html">test_this()</a></code>, <code><a href="../reference/test_this.R.html">lest_this()</a></code> and <code><a href="../reference/open_testfile.html">open_testfile()</a></code>.</li>
</ul>
<p><strong>Valid tags or test files (<code>pkg/tests/testthat/test_*.R</code>)</strong></p>
<ul>
<li>
<code>@testing &lt;functionname&gt;</code>: mark <code>functionname</code> as tested. Should usually go next the associated <code>test_that()</code> call. This is used by <code><a href="../reference/get_test_coverage.html">get_test_coverage()</a></code>.</li>
<li>
<code>@skip</code>: skip test when running <code><a href="http://www.rdocumentation.org/packages/testthis/topics/test_with_skip">testthis::test_with_skip()</a></code>. Best placed directly below the <code>context()</code> call.</li>
</ul>
<p>also look at <code>/test/testthat/test_Taglist.R</code> for examples.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#rstudio-addins">RStudio addins</a></li>
      <li><a href="#managing-test-data">Managing test data</a></li>
      <li><a href="#managing-test-subdirectories">Managing test subdirectories</a></li>
      <li><a href="#test-coverage-checklist">Test coverage checklist</a></li>
      <li><a href="#testthis-tags">Testthis Tags</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
